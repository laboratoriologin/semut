# Configuracao do framework topsys.

JNDI.CONNECTION java:comp/env/jdbc/bdAUDITLAURODEFREITAS

CLASS.BROKER.IMPL br.com.topsys.database.jdbc.TSDataBaseBrokerImpl

CLASS.SEQUENCE.IMPL br.com.topsys.database.jdbc.sequence.TSSequenceSQLServerImpl

CODIGO.UNIQUE 23505

CODIGO.FOREIGNKEY 23503

CODIGO.RAISE.EXCEPTION 1

#NoticiaDAO
noticiadao.pesquisar=SELECT  N.ID , N.TITULO , N.DESCRICAO, N.IMAGEM  , N.DATA , N.ID_TIPO_NOTICIA , TN.NOME FROM NOTICIAS N INNER JOIN TIPO_NOTICIAS TN ON TN.ID = N.ID_TIPO_NOTICIA
noticiadao.obterporfiltro=SELECT TOP 20 N.ID , N.TITULO , N.DESCRICAO, N.IMAGEM  , N.DATA , N.ID_TIPO_NOTICIA , TN.NOME FROM NOTICIAS N INNER JOIN TIPO_NOTICIAS TN ON TN.ID = N.ID_TIPO_NOTICIA  WHERE N.ID_TIPO_NOTICIA  = Coalesce(?, N.ID_TIPO_NOTICIA) ORDER BY N.DATA DESC
noticiadao.obterporid=SELECT ID,TITULO,DESCRICAO, IMAGEM FROM NOTICIAS WHERE ID = ?

#OcorrenciaDAO

ocorrenciadao.pesquisar=SELECT  ID , DESCRICAO , IMAGEM , LATITUDE , LONGITUDE , ID_USUARIO , ID_TIPO_OCORRENCIA  , STATUS FROM OCORRENCIAS
ocorrenciadao.inserir=INSERT INTO OCORRENCIAS (DESCRICAO,ID_USUARIO,IMAGEM,LATITUDE,LONGITUDE,STATUS,ID_TIPO_OCORRENCIA,DATA, SITUACAO, DATA_PENDENCIA) VALUES(?, ?, ?, ?,?,?,?,?,?, ?) 
ocorrenciadao.pesquisaralertas=SELECT TOP 20  O.ID , O.DESCRICAO , O.IMAGEM , O.LATITUDE , O.LONGITUDE , ID_USUARIO , ID_TIPO_OCORRENCIA , O.DATA , O.STATUS , O.DATA_ALERTA , UA.NOME , UA.EMAIL, TC.NOME   FROM OCORRENCIAS O INNER JOIN usuario_app  UA ON UA.ID = O.ID_USUARIO  INNER JOIN TIPO_OCORRENCIAS  TC ON TC.ID = O.ID_TIPO_OCORRENCIA  INNER JOIN GRUPO_OCORRENCIAS GO ON GO.ID = TC.ID_GRUPO_OCORRENCIA  WHERE O.STATUS  = Coalesce( ? , O.STATUS) AND GO.ID = 1 ORDER BY O.DATA_ALERTA DESC
ocorrenciadao.pesquisartodasocorrencias=SELECT O.ID , O.DESCRICAO , O.IMAGEM , O.LATITUDE , O.LONGITUDE , ID_USUARIO , ID_TIPO_OCORRENCIA , O.DATA , O.STATUS , O.DATA_ALERTA , UA.NOME , UA.EMAIL, TC.NOME   FROM OCORRENCIAS O INNER JOIN usuario_app  UA ON UA.ID = O.ID_USUARIO  INNER JOIN TIPO_OCORRENCIAS  TC ON TC.ID = O.ID_TIPO_OCORRENCIA  INNER JOIN GRUPO_OCORRENCIAS GO ON GO.ID = TC.ID_GRUPO_OCORRENCIA
ocorrenciadao.pesquisarocorrenciaspendentes=SELECT O.ID , O.DESCRICAO , O.IMAGEM , O.LATITUDE , O.LONGITUDE , ID_USUARIO , ID_TIPO_OCORRENCIA , O.DATA , O.STATUS , O.DATA_ALERTA , UA.NOME , UA.EMAIL, TC.NOME, GOC.NOME  FROM OCORRENCIAS O INNER JOIN usuario_app  UA ON UA.ID = O.ID_USUARIO  INNER JOIN TIPO_OCORRENCIAS  TC ON TC.ID = O.ID_TIPO_OCORRENCIA  INNER JOIN GRUPO_OCORRENCIAS GOC ON GOC.ID = TC.ID_GRUPO_OCORRENCIA  WHERE O.SITUACAO = 3 AND GOC.ID = COALESCE(?,GOC.ID) ORDER BY O.DATA DESC
ocorrenciadao.pesquisarqtdocorrenciasporstatus=SELECT S.DESCRICAO AS STATUS, COUNT(O.ID) AS QTD FROM OCORRENCIAS O, TIPO_SITUACAO S, TIPO_OCORRENCIAS TOC, GRUPO_OCORRENCIAS GO  WHERE GO.ID = TOC.ID_GRUPO_OCORRENCIA AND O.ID_TIPO_OCORRENCIA = TOC.ID AND O.SITUACAO = S.ID AND TOC.ID = COALESCE(?,TOC.ID) AND GO.ID = COALESCE(?,GO.ID) AND (CASE O.SITUACAO WHEN 1 THEN O.DATA_ACEITACAO	WHEN 2 THEN O.DATA_RECUSA WHEN 3 THEN O.DATA_PENDENCIA WHEN 4 THEN O.DATA_RESOLUCAO	ELSE NULL END) BETWEEN ? AND ? GROUP BY S.DESCRICAO
ocorrenciadao.pesquisarqtdocorrenciasporstatusregiao=SELECT S.DESCRICAO AS STATUS, COUNT(O.ID) AS QTD FROM OCORRENCIAS O, TIPO_SITUACAO S, TIPO_OCORRENCIAS TOC, GRUPO_OCORRENCIAS GO  WHERE GO.ID = TOC.ID_GRUPO_OCORRENCIA AND O.ID_TIPO_OCORRENCIA = TOC.ID AND O.SITUACAO = S.ID AND TOC.ID = COALESCE(?,TOC.ID) AND GO.ID = COALESCE(?,GO.ID) AND (CASE O.SITUACAO WHEN 1 THEN O.DATA_ACEITACAO WHEN 2 THEN O.DATA_RECUSA WHEN 3 THEN O.DATA_PENDENCIA WHEN 4 THEN O.DATA_RESOLUCAO ELSE NULL END) BETWEEN ? AND ? AND DBO.PERTENCEREGIAO(?, O.LATITUDE, O.LONGITUDE) = 1 GROUP BY S.DESCRICAO 
ocorrenciadao.pesquisarocorrenciascruas=SELECT O.ID , O.LATITUDE , O.LONGITUDE, S.ID, TOC.NOME, O.ID_USUARIO FROM OCORRENCIAS O, TIPO_SITUACAO S, TIPO_OCORRENCIAS TOC, GRUPO_OCORRENCIAS GO  WHERE GO.ID = TOC.ID_GRUPO_OCORRENCIA AND O.ID_TIPO_OCORRENCIA = TOC.ID AND O.SITUACAO = S.ID AND TOC.ID = COALESCE(?,TOC.ID) AND GO.ID = COALESCE(?,GO.ID) AND (CASE O.SITUACAO WHEN 1 THEN O.DATA_ACEITACAO	WHEN 2 THEN O.DATA_RECUSA WHEN 3 THEN O.DATA_PENDENCIA WHEN 4 THEN O.DATA_RESOLUCAO	ELSE NULL END) BETWEEN ? AND ? AND O.SITUACAO = Coalesce(?, O.SITUACAO)
ocorrenciadao.pesquisarocorrenciascruasregiao=SELECT O.ID , O.LATITUDE , O.LONGITUDE, S.ID, TOC.NOME, O.ID_USUARIO FROM OCORRENCIAS O, TIPO_SITUACAO S, TIPO_OCORRENCIAS TOC, GRUPO_OCORRENCIAS GO  WHERE GO.ID = TOC.ID_GRUPO_OCORRENCIA AND O.ID_TIPO_OCORRENCIA = TOC.ID AND O.SITUACAO = S.ID AND TOC.ID = COALESCE(?,TOC.ID) AND GO.ID = COALESCE(?,GO.ID) AND (CASE O.SITUACAO WHEN 1 THEN O.DATA_ACEITACAO	WHEN 2 THEN O.DATA_RECUSA WHEN 3 THEN O.DATA_PENDENCIA WHEN 4 THEN O.DATA_RESOLUCAO	ELSE NULL END) BETWEEN ? AND ? AND O.SITUACAO = Coalesce(?, O.SITUACAO) AND DBO.PERTENCEREGIAO(?, O.LATITUDE, O.LONGITUDE) = 1
ocorrenciadao.pesquisarocorrenciaindividual=SELECT O.ID , O.DESCRICAO , O.IMAGEM , O.LATITUDE , O.LONGITUDE , ID_USUARIO , ID_TIPO_OCORRENCIA , O.DATA , O.STATUS , O.DATA_ALERTA , UA.NOME , UA.EMAIL, TC.NOME, S.DESCRICAO, S.ID   FROM OCORRENCIAS O INNER JOIN usuario_app  UA ON UA.ID = O.ID_USUARIO  INNER JOIN TIPO_OCORRENCIAS  TC ON TC.ID = O.ID_TIPO_OCORRENCIA  INNER JOIN GRUPO_OCORRENCIAS GO ON GO.ID = TC.ID_GRUPO_OCORRENCIA INNER JOIN TIPO_SITUACAO S ON O.SITUACAO = S.ID WHERE O.ID = ?
ocorrenciadao.pesquisarqtdocorrenciasporusuario=SELECT S.DESCRICAO AS STATUS, COUNT(O.ID) AS QTD FROM OCORRENCIAS O, TIPO_SITUACAO S, TIPO_OCORRENCIAS TOC, GRUPO_OCORRENCIAS GO  WHERE GO.ID = TOC.ID_GRUPO_OCORRENCIA AND O.ID_TIPO_OCORRENCIA = TOC.ID AND O.SITUACAO = S.ID AND GO.ID = COALESCE(?,GO.ID) AND O.DATA BETWEEN ? AND ? GROUP BY S.DESCRICAO
ocorrenciadao.pesquisarqtdocorrenciasporusuarioregiao=SELECT S.DESCRICAO AS STATUS, COUNT(O.ID) AS QTD FROM OCORRENCIAS O, TIPO_SITUACAO S, TIPO_OCORRENCIAS TOC, GRUPO_OCORRENCIAS GO  WHERE GO.ID = TOC.ID_GRUPO_OCORRENCIA AND O.ID_TIPO_OCORRENCIA = TOC.ID AND O.SITUACAO = S.ID AND GO.ID = COALESCE(?,GO.ID) AND O.DATA BETWEEN ? AND ? AND DBO.PERTENCEREGIAO(?, O.LATITUDE, O.LONGITUDE) = 1 GROUP BY S.DESCRICAO
ocorrenciadao.pesquisarregioes=SELECT ID, NOME FROM REGIOES WHERE ID = Coalesce( ? , ID)
ocorrenciadao.obtercoordenadaregiao=SELECT LATITUDE, LONGITUDE FROM REGIOES_COORDENADAS WHERE REGIAO_ID = ? ORDER BY ID
ocorrenciadao.obterpendentesgeral=SELECT COUNT(*) FROM OCORRENCIAS O, TIPO_OCORRENCIAS TOC, GRUPO_OCORRENCIAS GOC WHERE O.ID_TIPO_OCORRENCIA = TOC.ID AND TOC.ID_GRUPO_OCORRENCIA = GOC.ID AND GOC.ID = COALESCE(?,GOC.ID) AND O.SITUACAO = 3 AND O.DATA_PENDENCIA IS NOT NULL
ocorrenciadao.pesquisarhojeporstatus=SELECT COUNT(O.ID),GOC.NOME FROM OCORRENCIAS O,TIPO_OCORRENCIAS TOC,GRUPO_OCORRENCIAS GOC WHERE O.ID_TIPO_OCORRENCIA = TOC.ID AND TOC.ID_GRUPO_OCORRENCIA = GOC.ID AND O.SITUACAO = ? AND CONVERT(VARCHAR(10),data_resolucao,110) = CONVERT(VARCHAR(10),GETDATE(),110) GROUP BY GOC.NOME

#TipoNoticiaDAO
tiponoticiadao.pesquisar=SELECT  ID , NOME FROM TIPO_NOTICIAS

#UsuarioAPPDAO
usuarioappdao.inserir=INSERT INTO USUARIO_APP(NOME,EMAIL,TELEFONE,SENHA) VALUES(?, ?, ?, ?)
usuarioappdao.obterporemail=SELECT ID , NOME , EMAIL , SENHA , TELEFONE  FROM USUARIO_APP WHERE EMAIL=?
usuarioappdao.alterar=UPDATE USUARIO_APP SET NOME=?,TELEFONE=?,SENHA=? WHERE EMAIL=?
usuarioappdao.pesquisar=SELECT ID , NOME , EMAIL , SENHA , TELEFONE FROM USUARIO_APP
usuarioappdao.alterarsenha=UPDATE USUARIO_APP SET SENHA=? WHERE ID=?

#UsuarioDAO
usuariodao.obterporemail=SELECT ID,LOGIN,SENHA,FLAG_ATIVO,NOME,GRUPO_ID,EMAIL  FROM USUARIOS WHERE EMAIL=?
usuariodao.alterarsenha=UPDATE USUARIOS SET SENHA=? WHERE ID=?

#TipoOcorrenciaDAO
tipoocorrenciadao.pesquisar=SELECT ID , ID_GRUPO_OCORRENCIA , NOME FROM TIPO_OCORRENCIAS
tipoocorrenciadao.obterporfiltro=SELECT  N.ID, N.ID_GRUPO_OCORRENCIA , N.NOME FROM TIPO_OCORRENCIAS N INNER JOIN GRUPO_OCORRENCIAS TN ON TN.ID = N.ID_GRUPO_OCORRENCIA  WHERE N.ID_GRUPO_OCORRENCIA  = Coalesce(?, N.ID_GRUPO_OCORRENCIA)

#TokenIphoneDAO
tokeniphonedao.pesquisar=SELECT TOKEN FROM TOKENS_IPHONE
tokeniphonedao.excluir=DELETE FROM TOKENS_IPHONE WHERE TOKEN=?
tokeniphonedao.inserir=INSERT INTO TOKENS_IPHONE(TOKEN) VALUES(?)
tokeniphonedao.obter=SELECT TOKEN FROM TOKENS_IPHONE WHERE TOKEN=?

#TokenAndroidDAO
tokenandroiddao.inserir=INSERT INTO TOKENS_ANDROID(TOKEN) VALUES(?)
tokenandroiddao.obter=SELECT TOKEN FROM TOKENS_ANDROID WHERE TOKEN=?
tokenandroiddao.pesquisar=SELECT TOKEN FROM TOKENS_ANDROID

#RegiaoDAO
regiaodao.pesquisarcoordenadas=SELECT LATITUDE,LONGITUDE FROM regioes_coordenadas where regiao_id=?
regiaodao.pesquisarqtdocorrencias=SELECT REG.ID,REG.NOME,(SELECT COUNT(*) FROM OCORRENCIAS O, TIPO_OCORRENCIAS TOC, GRUPO_OCORRENCIAS GO WHERE DBO.pertenceRegiao(reg.id,o.latitude,o.longitude)=1 AND O.situacao = 1 AND GO.ID = TOC.ID_GRUPO_OCORRENCIA AND O.ID_TIPO_OCORRENCIA = TOC.ID AND TOC.ID = COALESCE(?,TOC.ID) AND GO.ID = COALESCE(?,GO.ID) AND O.DATA_ACEITACAO BETWEEN ? AND ? ) AS ACEITAS,(SELECT COUNT(*) FROM OCORRENCIAS O, TIPO_OCORRENCIAS TOC, GRUPO_OCORRENCIAS GO WHERE DBO.pertenceRegiao(reg.id,o.latitude,o.longitude)=1 AND O.situacao = 2 AND GO.ID = TOC.ID_GRUPO_OCORRENCIA AND O.ID_TIPO_OCORRENCIA = TOC.ID AND TOC.ID = COALESCE(?,TOC.ID) AND GO.ID = COALESCE(?,GO.ID) AND DATA_RECUSA BETWEEN ? AND ?) AS RECUSADAS, (SELECT COUNT(*) FROM OCORRENCIAS O, TIPO_OCORRENCIAS TOC, GRUPO_OCORRENCIAS GO WHERE DBO.pertenceRegiao(reg.id,o.latitude,o.longitude)=1 AND O.situacao = 3 AND GO.ID = TOC.ID_GRUPO_OCORRENCIA AND O.ID_TIPO_OCORRENCIA = TOC.ID AND TOC.ID = COALESCE(?,TOC.ID) AND  GO.ID = COALESCE(?,GO.ID) AND DATA_PENDENCIA BETWEEN ? AND ?) AS PENDENTES, (SELECT COUNT(*) FROM OCORRENCIAS O, TIPO_OCORRENCIAS TOC, GRUPO_OCORRENCIAS GO WHERE DBO.pertenceRegiao(reg.id,o.latitude,o.longitude)=1 AND O.situacao = 4 AND GO.ID = TOC.ID_GRUPO_OCORRENCIA AND O.ID_TIPO_OCORRENCIA = TOC.ID AND TOC.ID = COALESCE(?,TOC.ID) AND GO.ID = COALESCE(?,GO.ID) AND DATA_RESOLUCAO BETWEEN ? AND ?) AS RESOLVIDAS FROM REGIOES REG WHERE REG.ID = Coalesce( ? , REG.ID) 

#GrupoOcorrenciaDAO
grupoocorrenciadao.pesquisarocorrenciaspormes=SELECT	COUNT(*),(CASE O.SITUACAO WHEN 1 THEN CONVERT(VARCHAR, datepart(MONTH, O.DATA_ACEITACAO))+ '/' + CONVERT(VARCHAR, datepart(YYYY, O.DATA_ACEITACAO))	WHEN 2 THEN CONVERT(VARCHAR, datepart(MONTH, O.DATA_RECUSA))+ '/' + CONVERT(VARCHAR, datepart(YYYY, O.DATA_RECUSA))	 WHEN 3 THEN CONVERT(VARCHAR, datepart(MONTH, O.DATA_PENDENCIA))+ '/' + CONVERT(VARCHAR, datepart(YYYY, O.DATA_PENDENCIA)) WHEN 4 THEN CONVERT(VARCHAR, datepart(MONTH, O.DATA_RESOLUCAO))+ '/' + CONVERT(VARCHAR, datepart(YYYY, O.DATA_RESOLUCAO)) END ), TS.DESCRICAO FROM OCORRENCIAS O, TIPO_OCORRENCIAS TOC, GRUPO_OCORRENCIAS GO, TIPO_SITUACAO TS WHERE O.ID_TIPO_OCORRENCIA = TOC.ID AND TOC.ID_GRUPO_OCORRENCIA = GO .ID AND TS.ID = O.SITUACAO AND TOC.ID = COALESCE(?,TOC.ID) AND GO.ID = COALESCE(?,GO.ID) AND (CASE O.SITUACAO WHEN 1 THEN O.DATA_ACEITACAO	WHEN 2 THEN O.DATA_RECUSA WHEN 3 THEN O.DATA_PENDENCIA WHEN 4 THEN O.DATA_RESOLUCAO	ELSE NULL END) BETWEEN ? AND ? GROUP BY ( CASE O.SITUACAO WHEN 1 THEN	 CONVERT(VARCHAR, datepart(YYYY, O.DATA_ACEITACAO))+ '-' + CONVERT(VARCHAR, datepart(MONTH, O.DATA_ACEITACAO)) WHEN 2 THEN CONVERT(VARCHAR, datepart(YYYY, O.DATA_RECUSA))+ '-' + CONVERT(VARCHAR, datepart(MONTH, O.DATA_RECUSA))	WHEN 3 THEN CONVERT(VARCHAR, datepart(YYYY, O.DATA_PENDENCIA))+ '-' + CONVERT(VARCHAR, datepart(MONTH, O.DATA_PENDENCIA)) WHEN 4 THEN CONVERT(VARCHAR, datepart(YYYY, O.DATA_RESOLUCAO))+ '-' + CONVERT(VARCHAR, datepart(MONTH, O.DATA_RESOLUCAO)) END ), ( CASE O.SITUACAO WHEN 1 THEN	 CONVERT(VARCHAR, datepart(MONTH, O.DATA_ACEITACAO))+ '/' + CONVERT(VARCHAR, datepart(YYYY, O.DATA_ACEITACAO)) WHEN 2 THEN CONVERT(VARCHAR, datepart(MONTH, O.DATA_RECUSA))+ '/' + CONVERT(VARCHAR, datepart(YYYY, O.DATA_RECUSA)) WHEN 3 THEN CONVERT(VARCHAR, datepart(MONTH, O.DATA_PENDENCIA))+ '/' + CONVERT(VARCHAR, datepart(YYYY, O.DATA_PENDENCIA)) WHEN 4 THEN CONVERT(VARCHAR, datepart(MONTH, O.DATA_RESOLUCAO))+ '/' + CONVERT(VARCHAR, datepart(YYYY, O.DATA_RESOLUCAO)) END ), TS.DESCRICAO ORDER BY( CASE O.SITUACAO WHEN 1 THEN CONVERT(VARCHAR, datepart(YYYY, O.DATA_ACEITACAO))+ '-' + CONVERT(VARCHAR, datepart(MONTH, O.DATA_ACEITACAO)) WHEN 2 THEN CONVERT(VARCHAR, datepart(YYYY, O.DATA_RECUSA))+ '-' + CONVERT(VARCHAR, datepart(MONTH, O.DATA_RECUSA))	WHEN 3 THEN CONVERT(VARCHAR, datepart(YYYY, O.DATA_PENDENCIA))+ '-' + CONVERT(VARCHAR, datepart(MONTH, O.DATA_PENDENCIA)) WHEN 4 THEN CONVERT(VARCHAR, datepart(YYYY, O.DATA_RESOLUCAO))+ '-' + CONVERT(VARCHAR, datepart(MONTH, O.DATA_RESOLUCAO)) END ), ( CASE O.SITUACAO WHEN 1 THEN	CONVERT(VARCHAR, datepart(MONTH, O.DATA_ACEITACAO))+ '/' + CONVERT(VARCHAR, datepart(YYYY, O.DATA_ACEITACAO)) WHEN 2 THEN CONVERT(VARCHAR, datepart(MONTH, O.DATA_RECUSA))+ '/' + CONVERT(VARCHAR, datepart(YYYY, O.DATA_RECUSA)) WHEN 3 THEN CONVERT(VARCHAR, datepart(MONTH, O.DATA_PENDENCIA))+ '/' + CONVERT(VARCHAR, datepart(YYYY, O.DATA_PENDENCIA)) WHEN 4 THEN CONVERT(VARCHAR, datepart(MONTH, O.DATA_RESOLUCAO))+ '/' + CONVERT(VARCHAR, datepart(YYYY, O.DATA_RESOLUCAO)) END ),TS.DESCRICAO
grupoocorrenciadao.pesquisarocorrenciaspordia=SELECT COUNT(*), CASE O.SITUACAO 	WHEN 1 THEN CONVERT(VARCHAR(11), O.DATA_ACEITACAO, 111) WHEN 2 THEN CONVERT(VARCHAR(11), O.DATA_RECUSA, 111) WHEN 3 THEN CONVERT(VARCHAR(11), O.DATA_PENDENCIA, 111) WHEN 4 THEN CONVERT(VARCHAR(11), O.DATA_RESOLUCAO, 111)		END, TS.DESCRICAO FROM 	OCORRENCIAS O, 	TIPO_OCORRENCIAS TOC, 	GRUPO_OCORRENCIAS GO,TIPO_SITUACAO TS WHERE O.ID_TIPO_OCORRENCIA = TOC.ID AND TOC.ID_GRUPO_OCORRENCIA = GO .ID AND TS.ID = O.SITUACAO AND TOC.ID = COALESCE(?,TOC.ID) AND GO.ID = COALESCE(?,GO.ID) AND (CASE O.SITUACAO WHEN 1 THEN O.DATA_ACEITACAO	WHEN 2 THEN O.DATA_RECUSA WHEN 3 THEN O.DATA_PENDENCIA WHEN 4 THEN O.DATA_RESOLUCAO	ELSE NULL END) BETWEEN ? AND ? GROUP BY ( CASE O.SITUACAO WHEN 1 THEN CONVERT(VARCHAR(11), O.DATA_ACEITACAO, 111) WHEN 2 THEN CONVERT(VARCHAR(11), O.DATA_RECUSA, 111) WHEN 3 THEN CONVERT(VARCHAR(11), O.DATA_PENDENCIA, 111) WHEN 4 THEN CONVERT(VARCHAR(11), O.DATA_RESOLUCAO, 111) END ),TS.DESCRICAO ORDER BY( CASE O.SITUACAO WHEN 1 THEN CONVERT(VARCHAR(11), O.DATA_ACEITACAO, 111) WHEN 2 THEN CONVERT(VARCHAR(11), O.DATA_RECUSA, 111) WHEN 3 THEN CONVERT(VARCHAR(11), O.DATA_PENDENCIA, 111) WHEN 4 THEN CONVERT(VARCHAR(11), O.DATA_RESOLUCAO, 111) END), TS.DESCRICAO
grupoocorrenciadao.pesquisarocorrenciasportemporesolucao=SELECT AVG(DATEDIFF(HOUR, O.DATA, O.DATA_RESOLUCAO)) ,CONVERT(VARCHAR, datepart(MONTH, o.DATA_RESOLUCAO))+ '/' + CONVERT(VARCHAR, datepart(YYYY, o.DATA_RESOLUCAO)) FROM OCORRENCIAS O,TIPO_OCORRENCIAS TOC,GRUPO_OCORRENCIAS GO WHERE O.ID_TIPO_OCORRENCIA = TOC.ID AND TOC.ID_GRUPO_OCORRENCIA = GO .ID AND O.DATA_RESOLUCAO IS NOT NULL AND TOC.ID = COALESCE(?,TOC.ID) AND GO .ID = ? and O.SITUACAO = 4 GROUP BY CONVERT(VARCHAR, datepart(YYYY, o.DATA_RESOLUCAO)) + '-' + CONVERT(VARCHAR, datepart(MONTH, o.DATA_RESOLUCAO)), CONVERT(VARCHAR, datepart(MONTH, o.DATA_RESOLUCAO))+ '/' + CONVERT(VARCHAR, datepart(YYYY, o.DATA_RESOLUCAO)) ORDER BY CONVERT(VARCHAR, datepart(YYYY, o.DATA_RESOLUCAO)) + '-' + CONVERT(VARCHAR, datepart(MONTH, o.DATA_RESOLUCAO))